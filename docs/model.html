<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>izo_1026_groups – model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">izo_1026_groups</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./model.html" rel="" target="" aria-current="page">
 <span class="menu-text">Model</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./evaluation.html" rel="" target="">
 <span class="menu-text">load data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#model" id="toc-model" class="nav-link active" data-scroll-target="#model">Model</a>
  <ul class="collapse">
  <li><a href="#first-level-model" id="toc-first-level-model" class="nav-link" data-scroll-target="#first-level-model">First-level model</a></li>
  <li><a href="#second-level-model" id="toc-second-level-model" class="nav-link" data-scroll-target="#second-level-model">Second-level model</a></li>
  <li><a href="#third-level-model" id="toc-third-level-model" class="nav-link" data-scroll-target="#third-level-model">Third-level model</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  <li><a href="#code-for-stan" id="toc-code-for-stan" class="nav-link" data-scroll-target="#code-for-stan">Code for Stan</a></li>
  <li><a href="#summary-of-estimated-model-parameters" id="toc-summary-of-estimated-model-parameters" class="nav-link" data-scroll-target="#summary-of-estimated-model-parameters">Summary of estimated model parameters</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>



<section id="model" class="level1">
<h1>Model</h1>
<p>A nonlinear relationship between the decimal logarithm of the retention factor (log k) and organic modifier (Neue et al.16 equation) was assumed to hold for all analytes <span class="math display">\[\begin{align}
\log k_{ij}= \log k_{w,i}-\frac{S_{1,i}\cdot \varphi_j}{1+S_{2,i}\cdot \varphi_j} ,\label{eg1}
\end{align}\]</span> where <span class="math inline">\(\log k_{w,i}\)</span>, <span class="math inline">\(S_1\)</span>,i, <span class="math inline">\(S_2\)</span>,i are the logarithm of the retention factor in water, the slope, and the curvature coefficient for the <span class="math inline">\(i\)</span>-th analyte, respectively, and <span class="math inline">\(\varphi_j\)</span> denotes the <span class="math inline">\(j\)</span>-th acetonitrile content. For convenience, this equation was reparametrized to the retention factor in acetonitrile (<span class="math inline">\(\log k_a\)</span>) noticing that: <span class="math display">\[\begin{align*}
\log k_{a,i}= \log k_{w,i}-\frac{S_{1,i}}{1+S_{2,i}}.
\end{align*}\]</span></p>
<section id="first-level-model" class="level3">
<h3 class="anchored" data-anchor-id="first-level-model">First-level model</h3>
<p>The observed retention factors (<span class="math inline">\(\log k_{obs,z}\)</span>) were further modeled as <span class="math display">\[\begin{align*}
\log k_{obs,z}\sim \text{Student t}(\nu_{obs},\log k_{i[z],j[z]},\sigma).
\end{align*}\]</span> where <span class="math inline">\(z\)</span> denotes the <span class="math inline">\(z\)</span>-th measurement and Student t denotes the Student’s t-distribution with the mean given by eq <span class="math inline">\(\ref{eq1}\)</span> standard deviation <span class="math inline">\(\sigma\)</span>, and normality parameter <span class="math inline">\(\nu_{obs}\)</span>. The Student’s t-distribution was used to ensure robustness to outliers at the measurement level.</p>
</section>
<section id="second-level-model" class="level3">
<h3 class="anchored" data-anchor-id="second-level-model">Second-level model</h3>
<p>Multilevel modeling allows us to include a range of second level models for analyte-specific parameters (<span class="math inline">\(\log k_{w,i}\)</span>, <span class="math inline">\(\log k_{a,i}\)</span>, and $S_{2,i}) <span class="math display">\[\begin{align*}
\begin{bsmallmatrix}
\log{k_{w,i}}  \\
\log{k_{a,i}} \\
\log{S_{2,i}}
\end{bsmallmatrix}=&amp; \text{MST}\left(\nu,   \begin{bsmallmatrix}
&amp;\theta_{\log{k_{w}}} +\beta_{\log k_{w}} \cdot (M_{mol,i}-300)/100-\pi_{\log k_{w}}\cdot X, &amp; \\
&amp; \theta_{\log{k_{a}}} +\beta_{\log k_{a}} \cdot (M_{mol,i}-300)/100-\pi_{\log k_{a}}\cdot X, &amp;  \\
&amp; \theta_{\log{S_{2}}} +\beta_{\log S_{2}} \cdot (M_{mol,i}-300)/100-\pi_{\log S_{2}}\cdot X, &amp;
\end{bsmallmatrix}, \Omega\right).
\end{align*}\]</span> where MST denotes the multivariate Student’s t-distribution; <span class="math inline">\(\theta\)</span> is a vector of mean values of chromatographic parameters, where <span class="math inline">\(\theta_{\log{k_{w}}}\)</span>, <span class="math inline">\(\theta_{\log{k_{a}}}\)</span>, and <span class="math inline">\(\theta_{\log{S_{2}}}\)</span> denote the mean values of analyte specific parameters for an analyte with the molecular mass of 300 and without any substituent, respectively; <span class="math inline">\(\nu\)</span> is a normality parameter; and <span class="math inline">\(\Omega\)</span> denotes a variance−covariance matrix. <span class="math inline">\(M_{mol}\)</span> is the molecular mass, <span class="math inline">\(\beta\)</span> is an effect of the molecular mass/100, where 100 is approximately the standard deviation of the available molecular masses of analytes, and <span class="math inline">\(\pi\)</span> is an effect of each functional group on chromatographic parameters with separate values for <span class="math inline">\(\log{k_{w}}\)</span>, <span class="math inline">\(\log{k_{a}}\)</span>, and <span class="math inline">\(\log{S_{2}}\)</span>. <span class="math inline">\(X\)</span> is a matrix of size 1026 × 100 that decodes the number of functional groups present on each analyte. The lack of a particular functional group was denoted as 0, and the presence of a functional group was denoted as <span class="math inline">\(n\)</span>, where <span class="math inline">\(n\)</span> denote the number of functional groups of the same type present on each analyte. <span class="math inline">\(S_2\)</span> was modeled on a logarithmic scale to ensure that <span class="math inline">\(S_2\)</span> values were positive.</p>
<p>Also, we decomposed the covariance matrix into a scale (<span class="math inline">\(\omega\)</span>) and a correlation (matrix <span class="math inline">\(\rho\)</span>) based on the formula to ease the specification of the prior distribution <span class="math display">\[\begin{align*}
\Omega = diag(\omega)\cdot \rho\cdot diag(\omega).
\end{align*}\]</span></p>
</section>
<section id="third-level-model" class="level3">
<h3 class="anchored" data-anchor-id="third-level-model">Third-level model</h3>
<p>Finally, a third-level model was used for regression parameters describing the effects of substituents (<span class="math inline">\(\pi_{\log S_{2}}\)</span>, <span class="math inline">\(\pi_{\log k_{w}}\)</span>, and <span class="math inline">\(\pi_{d\log k}\)</span> equal to the difference between <span class="math inline">\(\pi_{\log k_{w}}\)</span> and <span class="math inline">\(\pi_{\log k_{a}}\)</span>) <span class="math display">\[\begin{align*}
\pi_{\log k_{w},1:100}\sim \text{log-normal}(\ln(\theta_{\pi\log k_w}), \sigma_{\pi\log k_w}),\\
\pi_{d\log k,1:100}\sim \text{Student t}(\nu_{\pi}, \theta_{\pi d\log k}, \sigma_{\pi d\log k}),\\
\pi_{\log S_{2},1:100}\sim \text{N}(0, \sigma_{\pi\log S_2}),
\end{align*}\]</span> where <span class="math inline">\(\theta_{\pi}\)</span> denotes the effect of a typical functional group, and <span class="math inline">\(\sigma_{\pi}\)</span> is a standard deviation of the individual <span class="math inline">\(\pi_{1:100}\)</span> values. In this study, <span class="math inline">\(\pi\log k_w\)</span> was restricted to be positive using a log-normal distribution.</p>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<p>In this work were used weakly uninformative priors:</p>
<span class="math display">\[\begin{align*}
\nu_{obs} \sim Gamma(2,0.1),\\
\sigma \sim N_+(0,0.067),\\
\\
\nu \sim Gamma(2,0.1),\\
\theta_{\log k_{w}} \sim N(6.6,1.5),  \quad \theta_{\log k_{a}} \sim N(1.3,1.5),\\
\theta_{\log S_{2}},  \sim N(\log 2,0.2), \\
\beta_{\log k_{w}} \sim N(1.4,1.5), \quad
\beta_{\log k_{a}} \sim N(0.2,1.5), \\
\beta_{\log S_{2}} \sim N(0,0.2), \\
\omega_{\log k_{w}} \sim N_+(0,1.5),\\
\omega_{\log k_{a}} \sim N_+(0,1.5),\\
\omega_{\log S_{2}} \sim N_+(0,0.2),\\
\begin{bmatrix}
1 &amp; \rho_{1,2} &amp; \rho_{1,3} \\
\rho_{2,1} &amp; 1 &amp; \rho_{2,3} \\
\rho_{3,1} &amp; \rho_{3,2} &amp; 1
\end{bmatrix} \sim \text{LKJ}(1), \\
\\
\theta_{\pi \log k_w}\sim N_+(0,1.5), \quad \theta_{\pi d\log k}\sim N_(0,1.5),\\
\sigma_{\pi\log k_w},\sigma_{\pi d\log k}\sim N_+(0,1.5),\sigma_{\pi \log S_2}\sim N_+(0,0.2)\\
\nu_{\pi} \sim Gamma(2,0.1).\\
\end{align*}\]</span>
</section>
<section id="code-for-stan" class="level2">
<h2 class="anchored" data-anchor-id="code-for-stan">Code for Stan</h2>
<p>At the beginning, a model was constructed and implemented in the Stan program.</p>
<div class="cell" data-output.var="initial_model">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">functions</span>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> hplcmodel(<span class="dt">real</span> fi, <span class="dt">real</span> logkw, <span class="dt">real</span> logka, <span class="dt">real</span> logS2){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> logk;                                              <span class="co">// retention factor</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> S1;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    S1 = (logkw - logka)*(<span class="dv">1</span>+<span class="dv">10</span>^logS2);</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    logk = logkw - S1 * fi / (<span class="dv">1</span> + <span class="dv">10</span>^logS2 * fi);</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logk;</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nAnalytes;    <span class="co">// number of analytes</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nObs;         <span class="co">// number of observations</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> analyte[nObs];        <span class="co">// analytes indexes</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> start[nAnalytes];     <span class="co">// first apperance of analyte in "analyte" vector</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[nObs] logkObs;     <span class="co">// observed retention factors</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[nObs] fi;         <span class="co">// organic modifier content in the mobile phase</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> Mmolx[nObs];         <span class="co">// (moleculuar mass-300)/100</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; K;           <span class="co">//  number of predictors (functional groups)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[nAnalytes, K] nrfungroups;   <span class="co">// predictor matrix (functional groups)   </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>, <span class="kw">upper</span> = <span class="dv">1</span>&gt; run_estimation; <span class="co">// 0 for prior predictive, 1 for estimation</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span> logkwHat; <span class="co">// mean value of logkw </span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span> logkaHat; <span class="co">// mean value of logka </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span> logS2Hat; <span class="co">// mean curvature coefficient </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; sigma;     <span class="co">// standard deviation for residuals</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> <span class="dt">vector</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[<span class="dv">3</span>] omega;<span class="co">// diagonal elements of variance-covariance matrix for inter-analyte variability </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> <span class="dt">corr_matrix</span>[<span class="dv">3</span>] rho;        <span class="co">// correlation matrix       </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; nu;        <span class="co">// normality constant for inter-analyte variability </span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; nuobs;     <span class="co">// normality constant for residual variability </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; nupi;     <span class="co">// normality constant for residual variability </span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span> beta[<span class="dv">3</span>];              <span class="co">// regression coefficients for Mmolx</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a> <span class="dt">vector</span>[<span class="dv">3</span>] param[nAnalytes]; <span class="co">// individual values of chromatographic parameters</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a> <span class="dt">vector</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[K] pilogkw;  <span class="co">// regression coefficient for logkw</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> <span class="dt">vector</span>[K] pidlogk ;  <span class="co">//... logka logkw difference</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a> <span class="dt">vector</span>[K] pilogS2;             <span class="co">// ... logS2</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; spilogkw;      <span class="co">// group-level std for logkw</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; spidlogk;      <span class="co">//... logka</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; spilogS2;      <span class="co">//... logS2</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; mpilogkw;      <span class="co">// group-level mean for logkw</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a> <span class="dt">real</span> mpidlogk;      <span class="co">//... logka</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span>{</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[<span class="dv">3</span>] miu[nAnalytes];  </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> logka[nAnalytes];</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> logkw[nAnalytes];</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> logS2[nAnalytes];</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K] pilogka;</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cov_matrix</span>[<span class="dv">3</span>] Omega;           <span class="co">// variance-covariance matrix</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[nObs] logkHat;     </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  Omega = quad_form_diag(rho, omega);   <span class="co">// diag_matrix(omega) * rho * diag_matrix(omega)</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  pilogka = pilogkw - pidlogk;</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span>:nAnalytes){</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    miu[j,<span class="dv">1</span>]  = logkwHat + beta[<span class="dv">1</span>] * Mmolx[start[j]] - nrfungroups[j,<span class="dv">1</span>:K] * pilogkw;</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    miu[j,<span class="dv">2</span>]  = logkaHat + beta[<span class="dv">2</span>] * Mmolx[start[j]] - nrfungroups[j,<span class="dv">1</span>:K] * pilogka; </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    miu[j,<span class="dv">3</span>]  = logS2Hat + beta[<span class="dv">3</span>] * Mmolx[start[j]] + nrfungroups[j,<span class="dv">1</span>:K] * pilogS2;</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span>:nAnalytes){</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        logkw[j] = param[j, <span class="dv">1</span>];</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        logka[j] = param[j, <span class="dv">2</span>];</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        logS2[j] = param[j, <span class="dv">3</span>];</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:nObs){</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    logkHat[i] = hplcmodel(fi[i], logkw[analyte[i]], logka[analyte[i]], logS2[analyte[i]]);</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  logkwHat ~ normal(<span class="fl">6.6</span>, <span class="fl">1.5</span>);  <span class="co">//3.6+2*1.5</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  logkaHat ~ normal(<span class="fl">1.3</span>, <span class="fl">1.5</span>); <span class="co">//-1.7+2*1.5</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  logS2Hat ~ normal(log10(<span class="dv">2</span>), <span class="fl">0.2</span>);</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">1</span>]  ~ normal(<span class="fl">1.4</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">2</span>]  ~ normal(<span class="fl">0.2</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">3</span>]  ~ normal(<span class="dv">0</span>,<span class="fl">0.2</span>);</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  omega[<span class="dv">1</span>] ~ normal(<span class="dv">0</span>,<span class="fl">1.50</span>);</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  omega[<span class="dv">2</span>] ~ normal(<span class="dv">0</span>,<span class="fl">1.50</span>);</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  omega[<span class="dv">3</span>] ~ normal(<span class="dv">0</span>,<span class="fl">0.2</span>);</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  rho   ~ lkj_corr(<span class="dv">1</span>);</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  sigma  ~ normal(<span class="dv">0</span>,<span class="fl">0.067</span>);</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  mpilogkw ~ normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  mpidlogk ~ normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  spilogkw ~ normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  spidlogk ~ normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  spilogS2 ~ normal(<span class="dv">0</span>,<span class="fl">0.2</span>);</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  pilogkw ~ lognormal(log(mpilogkw),spilogkw);</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  pidlogk ~ student_t(nupi,mpidlogk,spidlogk);</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  pilogS2 ~ normal(<span class="dv">0</span>,spilogS2);</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  nu    ~ gamma(<span class="dv">2</span>,<span class="fl">0.1</span>);</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  nuobs ~ gamma(<span class="dv">2</span>,<span class="fl">0.1</span>);</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  nupi  ~ gamma(<span class="dv">2</span>,<span class="fl">0.1</span>);</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span>  <span class="dv">1</span>:nAnalytes){</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  param[i] ~ multi_student_t(nu,miu[i],Omega);</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(run_estimation==<span class="dv">1</span>){</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  logkObs ~ student_t(nuobs,logkHat,sigma); <span class="co">// likelihood</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span>{</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> logkCond[nObs];</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> logkPred[nObs];</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> log_lik[nObs];</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[<span class="dv">3</span>] paramPred[nAnalytes]; </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span>:nAnalytes){</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>   paramPred[j] = multi_student_t_rng(nu,miu[j],Omega);</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:nObs){</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>   <span class="dt">real</span> logkHatPred;    <span class="co">// predicted logk   </span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>   logkHatPred = hplcmodel(fi[i], paramPred[analyte[i],<span class="dv">1</span>], paramPred[analyte[i],<span class="dv">2</span>], paramPred[analyte[i],<span class="dv">3</span>]);</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>   logkCond[i] = student_t_rng(nuobs, logkHat[i], sigma);</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>   logkPred[i] = student_t_rng(nuobs, logkHatPred, sigma);</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>   log_lik[i]= student_t_lpdf(logkObs[i] | nuobs, logkHat[i], sigma);</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, the data was added to it and the initial values of the model parameters were determined. In the end, the model was fitted.</p>
<p>Below code preapering data to fit the model in supercomputer:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gridExtra)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>DS       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/database_stan_1026.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>DS_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/database_stan_1026_analyte_names.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>functional_groups         <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/checkmol_nr_groups.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>functional_groups_names   <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/checkmol_functional_group_names.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="do">### prepearing data with functional groups</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">8.1</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">8</span>; <span class="co"># heterocyclic compounds with more than 8 heterocycles are treated as if they have eigth</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>idx_not_present <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colSums</span>(functional_groups<span class="sc">==</span><span class="dv">0</span>) <span class="sc">==</span> <span class="fu">nrow</span>(functional_groups))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_not_present]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_not_present,]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>nAnalytes<span class="ot">=</span><span class="fu">length</span>(<span class="fu">unique</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>nObs<span class="ot">=</span><span class="fu">length</span>(DS<span class="sc">$</span>ID)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>analyte<span class="ot">=</span><span class="fu">match</span>(DS<span class="sc">$</span>ID, <span class="fu">unique</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">which</span>(<span class="sc">!</span><span class="fu">duplicated</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>K<span class="ot">=</span><span class="fu">ncol</span>(functional_groups)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>Mmolx<span class="ot">=</span>(DS<span class="sc">$</span>MW_ACD<span class="dv">-300</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>nrfungroups<span class="ot">=</span>functional_groups</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>logkObs<span class="ot">=</span>DS<span class="sc">$</span>logk</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>fi<span class="ot">=</span>DS<span class="sc">$</span>concentration</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>run_estimation<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="fu">stan_rdump</span>(<span class="fu">c</span>(<span class="st">"nAnalytes"</span>, </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>             <span class="st">"nObs"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>             <span class="st">"start"</span>, </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>             <span class="st">"analyte"</span>, </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>             <span class="st">"logkObs"</span>, </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>             <span class="st">"fi"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>             <span class="st">"K"</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>             <span class="st">"nrfungroups"</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Mmolx"</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>             <span class="st">"run_estimation"</span>),</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>           <span class="at">file=</span><span class="st">"2_model/model.data.R"</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>initial_param_A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">2</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  initial_param_A[i,] <span class="ot">=</span> </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">polyfit</span>(DS<span class="sc">$</span>concentration[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>DS<span class="sc">$</span>concentration[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)]),</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            DS<span class="sc">$</span>logk[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)],<span class="dv">1</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>initial_param_A <span class="ot">=</span> <span class="fu">cbind</span>(initial_param_A,<span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes))</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>param <span class="ot">=</span> <span class="fu">cbind</span>(initial_param_A[,<span class="dv">2</span>], initial_param_A[,<span class="dv">2</span>] <span class="sc">+</span> initial_param_A[,<span class="dv">1</span>]<span class="sc">/</span><span class="dv">3</span>, <span class="fu">log10</span>(initial_param_A[,<span class="dv">3</span>]))</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  logkwHat  <span class="ot">=</span>  <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">6.6</span>,<span class="dv">1</span>)</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  logkaHat  <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">1.3</span>,<span class="dv">1</span>)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  logS2Hat <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="dv">2</span>),<span class="fl">0.1</span>)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="fl">0.2</span>,<span class="dv">0</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span><span class="fu">rlnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">0.05</span>),<span class="fl">0.2</span>)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  nuobs <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  nupi <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  pilogkw <span class="ot">=</span> <span class="fu">rlnorm</span>(K,<span class="fu">log</span>(<span class="fl">0.2</span>),<span class="fl">0.5</span>)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  pidlogk <span class="ot">=</span> <span class="fu">rnorm</span>(K,<span class="fl">0.2</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  pilogS2 <span class="ot">=</span> <span class="fu">rnorm</span>(K,<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  omega<span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  spilogkw<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  spidlogk<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  spilogS2<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  mpilogkw <span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  mpidlogk <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  param  <span class="ot">=</span> param</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_rdump</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"logkaHat"</span>,<span class="st">"logS2Hat"</span>,<span class="st">"beta"</span>,<span class="st">"rho"</span>,<span class="st">"sigma"</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>               <span class="st">"nu"</span>,<span class="st">"nuobs"</span>,<span class="st">"nupi"</span>,<span class="st">"pilogkw"</span>,<span class="st">"pidlogk"</span>,<span class="st">"pilogS2"</span>,<span class="st">"omega"</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>               <span class="st">"spilogkw"</span>,<span class="st">"spidlogk"</span>,<span class="st">"spilogS2"</span>,<span class="st">"mpilogkw"</span>,<span class="st">"mpidlogk"</span>,<span class="st">"param"</span>),</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>             <span class="at">file=</span><span class="fu">paste</span>(<span class="st">"2_model/model_"</span>, i, <span class="st">".init.R"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimated-model-parameters" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimated-model-parameters">Summary of estimated model parameters</h2>
<p>Code for print summary of parameters from supercomputer:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="st">'2_model/output_1.csv'</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_2.csv'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_3.csv'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_4.csv'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_5.csv'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_6.csv'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_7.csv'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_8.csv'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_9.csv'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_10.csv'</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"logkaHat"</span>,<span class="st">"logS2Hat"</span>,<span class="st">"beta"</span>,<span class="st">"rho"</span>,<span class="st">"sigma"</span>,<span class="st">"nu"</span>,<span class="st">"nuobs"</span>,<span class="st">"nupi"</span>,<span class="st">"omega"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"spilogkw"</span>,<span class="st">"spidlogk"</span>,<span class="st">"spilogS2"</span>,<span class="st">"mpilogkw"</span>,<span class="st">"mpidlogk"</span>), <span class="at">max_rows =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pojawiły się wartości NA na skutek przekształcenia

Warning: pojawiły się wartości NA na skutek przekształcenia</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> variable  mean median   sd  mad    q5   q95 rhat ess_bulk ess_tail
 logkwHat  7.07   7.07 0.17 0.17  6.80  7.36 1.01      658     1251
 logkaHat  0.05   0.05 0.07 0.07 -0.07  0.17 1.00     3189     2771
 logS2Hat  0.38   0.38 0.03 0.03  0.34  0.42 1.00     2232     3076
 beta[1]   2.64   2.64 0.08 0.07  2.51  2.76 1.01      915     1959
 beta[2]   0.40   0.40 0.03 0.03  0.35  0.45 1.00     3414     3175
 beta[3]  -0.02  -0.02 0.01 0.01 -0.04  0.00 1.00     1912     3291
 rho[1,1]  1.00   1.00 0.00 0.00  1.00  1.00   NA       NA       NA
 rho[2,1]  0.62   0.62 0.03 0.03  0.57  0.66 1.00     2436     3500
 rho[3,1] -0.14  -0.14 0.05 0.05 -0.22 -0.06 1.01     1501     2517
 rho[1,2]  0.62   0.62 0.03 0.03  0.57  0.66 1.00     2436     3500
 rho[2,2]  1.00   1.00 0.00 0.00  1.00  1.00   NA       NA       NA
 rho[3,2] -0.27  -0.27 0.05 0.05 -0.35 -0.20 1.00     2015     3561
 rho[1,3] -0.14  -0.14 0.05 0.05 -0.22 -0.06 1.01     1501     2517
 rho[2,3] -0.27  -0.27 0.05 0.05 -0.35 -0.20 1.00     2015     3561
 rho[3,3]  1.00   1.00 0.00 0.00  1.00  1.00   NA       NA       NA
 sigma     0.01   0.01 0.00 0.00  0.01  0.01 1.01      781     1975
 nu        2.32   2.31 0.20 0.20  2.02  2.67 1.01     1157     2365
 nuobs     1.33   1.33 0.05 0.05  1.24  1.42 1.01     1422     2702
 nupi      9.87   6.87 8.80 4.93  2.37 27.48 1.01     1773     2556
 omega[1]  0.73   0.73 0.04 0.03  0.67  0.79 1.01     1519     2886
 omega[2]  0.33   0.33 0.02 0.02  0.30  0.36 1.01     1392     3054
 omega[3]  0.12   0.12 0.01 0.01  0.11  0.13 1.00     1686     2973
 spilogkw  0.83   0.83 0.10 0.10  0.69  1.00 1.00     1519     2566
 spidlogk  0.25   0.25 0.05 0.05  0.17  0.33 1.01     1041     2132
 spilogS2  0.07   0.07 0.01 0.01  0.06  0.08 1.00     1635     2527
 mpilogkw  0.49   0.49 0.06 0.06  0.39  0.60 1.01     1022     2419
 mpidlogk  0.38   0.37 0.05 0.05  0.30  0.46 1.01     1027     2026</code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>A nonlinear relationship between the decimal logarithm of the retention factor (log k) and organic modifier (Neue et al.16 equation) was assumed to hold for all analytes \begin{align}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> \log k_{ij}= \log k_{w,i}-\frac{S_{1,i}\cdot \varphi_j}{1+S_{2,i}\cdot \varphi_j} ,\label{eg1}</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>\end{align} where $\log k_{w,i}$, $S_1$,i, $S_2$,i are the logarithm of the retention factor in water, the slope, and the curvature coefficient for the $i$-th analyte, respectively, and $\varphi_j$ denotes the $j$-th acetonitrile content. For convenience, this equation was reparametrized to the retention factor in acetonitrile ($\log k_a$) noticing that: \begin{align*}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> \log k_{a,i}= \log k_{w,i}-\frac{S_{1,i}}{1+S_{2,i}}.</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">### First-level model</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>The observed retention factors ($\log k_{obs,z}$) were further modeled as \begin{align*}</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a> \log k_{obs,z}\sim \text{Student t}(\nu_{obs},\log k_{i<span class="co">[</span><span class="ot">z</span><span class="co">]</span>,j<span class="co">[</span><span class="ot">z</span><span class="co">]</span>},\sigma).</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>\end{align*} where $z$ denotes the $z$-th measurement and Student t denotes the Student's t-distribution with the mean given by eq \ref{eq1} standard deviation $\sigma$, and normality parameter $\nu_{obs}$. The Student's t-distribution was used to ensure robustness to outliers at the measurement level.</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">### Second-level model</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>Multilevel modeling allows us to include a range of second level models for analyte-specific parameters ($\log k_{w,i}$, $\log k_{a,i}$, and \$\log S<span class="sc">\_</span>{2,i}) \begin{align*}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>\begin{bsmallmatrix}</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>\log{k_{w,i}}  <span class="sc">\\</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>\log{k_{a,i}} <span class="sc">\\</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>\log{S_{2,i}}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>\end{bsmallmatrix}=&amp; \text{MST}\left(\nu,   \begin{bsmallmatrix}</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a> &amp;\theta_{\log{k_{w}}} +\beta_{\log k_{w}} \cdot (M_{mol,i}-300)/100-\pi_{\log k_{w}}\cdot X, &amp; <span class="sc">\\</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a> &amp; \theta_{\log{k_{a}}} +\beta_{\log k_{a}} \cdot (M_{mol,i}-300)/100-\pi_{\log k_{a}}\cdot X, &amp;  <span class="sc">\\</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{\log{S_{2}}} +\beta_{\log S_{2}} \cdot (M_{mol,i}-300)/100-\pi_{\log S_{2}}\cdot X, &amp;</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>\end{bsmallmatrix}, \Omega\right).</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>\end{align*} where MST denotes the multivariate Student's t-distribution; $\theta$ is a vector of mean values of chromatographic parameters, where $\theta_{\log{k_{w}}}$, $\theta_{\log{k_{a}}}$, and $\theta_{\log{S_{2}}}$ denote the mean values of analyte specific parameters for an analyte with the molecular mass of 300 and without any substituent, respectively; $\nu$ is a normality parameter; and $\Omega$ denotes a variance−covariance matrix. $M_{mol}$ is the molecular mass, $\beta$ is an effect of the molecular mass/100, where 100 is approximately the standard deviation of the available molecular masses of analytes, and $\pi$ is an effect of each functional group on chromatographic parameters with separate values for $\log{k_{w}}$, $\log{k_{a}}$, and $\log{S_{2}}$. $X$ is a matrix of size 1026 × 100 that decodes the number of functional groups present on each analyte. The lack of a particular functional group was denoted as 0, and the presence of a functional group was denoted as $n$, where $n$ denote the number of functional groups of the same type present on each analyte. $S_2$ was modeled on a logarithmic scale to ensure that $S_2$ values were positive.</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>Also, we decomposed the covariance matrix into a scale ($\omega$) and a correlation (matrix $\rho$) based on the formula to ease the specification of the prior distribution \begin{align*}</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>\Omega = diag(\omega)\cdot \rho\cdot diag(\omega).</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">### Third-level model</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>Finally, a third-level model was used for regression parameters describing the effects of substituents ($\pi_{\log S_{2}}$, $\pi_{\log k_{w}}$, and $\pi_{d\log k}$ equal to the difference between $\pi_{\log k_{w}}$ and $\pi_{\log k_{a}}$) \begin{align*}</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>\pi_{\log k_{w},1:100}\sim \text{log-normal}(\ln(\theta_{\pi\log k_w}), \sigma_{\pi\log k_w}),<span class="sc">\\</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>\pi_{d\log k,1:100}\sim \text{Student t}(\nu_{\pi}, \theta_{\pi d\log k}, \sigma_{\pi d\log k}),<span class="sc">\\</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>\pi_{\log S_{2},1:100}\sim \text{N}(0, \sigma_{\pi\log S_2}),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>\end{align*} where $\theta_{\pi}$ denotes the effect of a typical functional group, and $\sigma_{\pi}$ is a standard deviation of the individual $\pi_{1:100}$ values. In this study, $\pi\log k_w$ was restricted to be positive using a log-normal distribution.</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>In this work were used weakly uninformative priors:</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="in">\nu_{obs} \sim Gamma(2,0.1),\\</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="in">\sigma \sim N_+(0,0.067),\\</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="in">\\</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="in">\nu \sim Gamma(2,0.1),\\</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="in">\theta_{\log k_{w}} \sim N(6.6,1.5),  \quad \theta_{\log k_{a}} \sim N(1.3,1.5),\\</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="in">\theta_{\log S_{2}},  \sim N(\log 2,0.2), \\</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="in">\beta_{\log k_{w}} \sim N(1.4,1.5), \quad</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="in">\beta_{\log k_{a}} \sim N(0.2,1.5), \\</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="in">\beta_{\log S_{2}} \sim N(0,0.2), \\</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="in">\omega_{\log k_{w}} \sim N_+(0,1.5),\\</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="in">\omega_{\log k_{a}} \sim N_+(0,1.5),\\</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="in">\omega_{\log S_{2}} \sim N_+(0,0.2),\\</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{bmatrix}</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="in"> 1 &amp; \rho_{1,2} &amp; \rho_{1,3} \\</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="in"> \rho_{2,1} &amp; 1 &amp; \rho_{2,3} \\</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="in"> \rho_{3,1} &amp; \rho_{3,2} &amp; 1 </span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="in"> \end{bmatrix} \sim \text{LKJ}(1), \\</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="in"> \\</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="in">\theta_{\pi \log k_w}\sim N_+(0,1.5), \quad \theta_{\pi d\log k}\sim N_(0,1.5),\\</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="in">\sigma_{\pi\log k_w},\sigma_{\pi d\log k}\sim N_+(0,1.5),\sigma_{\pi \log S_2}\sim N_+(0,0.2)\\</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="in">\nu_{\pi} \sim Gamma(2,0.1).\\</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code for Stan</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>At the beginning, a model was constructed and implemented in the Stan program.</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan output.var="initial_model", eval = FALSE}</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="in">functions{</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="in">  real hplcmodel(real fi, real logkw, real logka, real logS2){</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="in">    real logk;                                              // retention factor</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="in">    real S1;</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="in">    S1 = (logkw - logka)*(1+10^logS2);</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="in">    logk = logkw - S1 * fi / (1 + 10^logS2 * fi);</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="in">    return logk;</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="in">data{</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="in">  int nAnalytes;    // number of analytes</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="in">  int nObs;         // number of observations</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="in">  int analyte[nObs];        // analytes indexes</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="in">  int start[nAnalytes];     // first apperance of analyte in "analyte" vector</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[nObs] logkObs;     // observed retention factors</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[nObs] fi;         // organic modifier content in the mobile phase</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="in">  real Mmolx[nObs];         // (moleculuar mass-300)/100</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; K;           //  number of predictors (functional groups)</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="in">  matrix[nAnalytes, K] nrfungroups;   // predictor matrix (functional groups)   </span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower = 0, upper = 1&gt; run_estimation; // 0 for prior predictive, 1 for estimation</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="in">parameters{</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="in"> real logkwHat; // mean value of logkw </span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="in"> real logkaHat; // mean value of logka </span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="in"> real logS2Hat; // mean curvature coefficient </span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 0&gt; sigma;     // standard deviation for residuals</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="in"> vector&lt;lower = 0&gt;[3] omega;// diagonal elements of variance-covariance matrix for inter-analyte variability </span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="in"> corr_matrix[3] rho;        // correlation matrix       </span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 1&gt; nu;        // normality constant for inter-analyte variability </span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 1&gt; nuobs;     // normality constant for residual variability </span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 1&gt; nupi;     // normality constant for residual variability </span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="in"> real beta[3];              // regression coefficients for Mmolx</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="in"> vector[3] param[nAnalytes]; // individual values of chromatographic parameters</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="in"> vector&lt;lower = 0&gt;[K] pilogkw;  // regression coefficient for logkw</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="in"> vector[K] pidlogk ;  //... logka logkw difference</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a><span class="in"> vector[K] pilogS2;             // ... logS2</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 0&gt; spilogkw;      // group-level std for logkw</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 0&gt; spidlogk;      //... logka</span></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 0&gt; spilogS2;      //... logS2</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a><span class="in"> real&lt;lower = 0&gt; mpilogkw;      // group-level mean for logkw</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a><span class="in"> real mpidlogk;      //... logka</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="in">transformed parameters{</span></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[3] miu[nAnalytes];  </span></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a><span class="in">  real logka[nAnalytes];</span></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="in">  real logkw[nAnalytes];</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="in">  real logS2[nAnalytes];</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[K] pilogka;</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a><span class="in">  cov_matrix[3] Omega;           // variance-covariance matrix</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[nObs] logkHat;     </span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a><span class="in">  Omega = quad_form_diag(rho, omega);   // diag_matrix(omega) * rho * diag_matrix(omega)</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="in">  pilogka = pilogkw - pidlogk;</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a><span class="in">  for(j in 1:nAnalytes){</span></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a><span class="in">    miu[j,1]  = logkwHat + beta[1] * Mmolx[start[j]] - nrfungroups[j,1:K] * pilogkw;</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a><span class="in">    miu[j,2]  = logkaHat + beta[2] * Mmolx[start[j]] - nrfungroups[j,1:K] * pilogka; </span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a><span class="in">    miu[j,3]  = logS2Hat + beta[3] * Mmolx[start[j]] + nrfungroups[j,1:K] * pilogS2;</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a><span class="in">  for(j in 1:nAnalytes){</span></span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a><span class="in">        logkw[j] = param[j, 1];</span></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a><span class="in">        logka[j] = param[j, 2];</span></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a><span class="in">        logS2[j] = param[j, 3];</span></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a><span class="in"> }</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a><span class="in">  for(i in 1:nObs){</span></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="in">    logkHat[i] = hplcmodel(fi[i], logkw[analyte[i]], logka[analyte[i]], logS2[analyte[i]]);</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a><span class="in"> }</span></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a><span class="in">model{</span></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a><span class="in">  logkwHat ~ normal(6.6, 1.5);  //3.6+2*1.5</span></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a><span class="in">  logkaHat ~ normal(1.3, 1.5); //-1.7+2*1.5</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a><span class="in">  logS2Hat ~ normal(log10(2), 0.2);</span></span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a><span class="in">  beta[1]  ~ normal(1.4,1.5);</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a><span class="in">  beta[2]  ~ normal(0.2,1.5);</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a><span class="in">  beta[3]  ~ normal(0,0.2);</span></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a><span class="in">  omega[1] ~ normal(0,1.50);</span></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a><span class="in">  omega[2] ~ normal(0,1.50);</span></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a><span class="in">  omega[3] ~ normal(0,0.2);</span></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a><span class="in">  rho   ~ lkj_corr(1);</span></span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a><span class="in">  sigma  ~ normal(0,0.067);</span></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a><span class="in">  mpilogkw ~ normal(0,1.5);</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a><span class="in">  mpidlogk ~ normal(0,1.5);</span></span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a><span class="in">  spilogkw ~ normal(0,1.5);</span></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a><span class="in">  spidlogk ~ normal(0,1.5);</span></span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a><span class="in">  spilogS2 ~ normal(0,0.2);</span></span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a><span class="in">  pilogkw ~ lognormal(log(mpilogkw),spilogkw);</span></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a><span class="in">  pidlogk ~ student_t(nupi,mpidlogk,spidlogk);</span></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a><span class="in">  pilogS2 ~ normal(0,spilogS2);</span></span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a><span class="in">  nu    ~ gamma(2,0.1);</span></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a><span class="in">  nuobs ~ gamma(2,0.1);</span></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a><span class="in">  nupi  ~ gamma(2,0.1);</span></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a><span class="in">  for(i in  1:nAnalytes){</span></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a><span class="in">  param[i] ~ multi_student_t(nu,miu[i],Omega);</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a><span class="in">  if(run_estimation==1){</span></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="in">  logkObs ~ student_t(nuobs,logkHat,sigma); // likelihood</span></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a><span class="in">generated quantities{</span></span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a><span class="in">  real logkCond[nObs];</span></span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a><span class="in">  real logkPred[nObs];</span></span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a><span class="in">  real log_lik[nObs];</span></span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[3] paramPred[nAnalytes]; </span></span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="in">  for(j in 1:nAnalytes){</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a><span class="in">   paramPred[j] = multi_student_t_rng(nu,miu[j],Omega);</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a><span class="in">  for(i in 1:nObs){</span></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a><span class="in">   real logkHatPred;    // predicted logk   </span></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a><span class="in">   logkHatPred = hplcmodel(fi[i], paramPred[analyte[i],1], paramPred[analyte[i],2], paramPred[analyte[i],3]);</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a><span class="in">   logkCond[i] = student_t_rng(nuobs, logkHat[i], sigma);</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a><span class="in">   logkPred[i] = student_t_rng(nuobs, logkHatPred, sigma);</span></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a><span class="in">   log_lik[i]= student_t_lpdf(logkObs[i] | nuobs, logkHat[i], sigma);</span></span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>Then, the data was added to it and the initial values of the model parameters were determined. In the end, the model was fitted.</span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>Below code preapering data to fit the model in supercomputer:</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gridExtra)</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>DS       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/database_stan_1026.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>DS_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/database_stan_1026_analyte_names.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a>functional_groups         <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/checkmol_nr_groups.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>functional_groups_names   <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"1_data/checkmol_functional_group_names.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a><span class="do">### prepearing data with functional groups</span></span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">8.1</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">8</span>; <span class="co"># heterocyclic compounds with more than 8 heterocycles are treated as if they have eigth</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>)</span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>idx_not_present <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colSums</span>(functional_groups<span class="sc">==</span><span class="dv">0</span>) <span class="sc">==</span> <span class="fu">nrow</span>(functional_groups))</span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_not_present]</span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_not_present,]</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>nAnalytes<span class="ot">=</span><span class="fu">length</span>(<span class="fu">unique</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>nObs<span class="ot">=</span><span class="fu">length</span>(DS<span class="sc">$</span>ID)</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>analyte<span class="ot">=</span><span class="fu">match</span>(DS<span class="sc">$</span>ID, <span class="fu">unique</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">which</span>(<span class="sc">!</span><span class="fu">duplicated</span>(DS<span class="sc">$</span>ID))</span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>K<span class="ot">=</span><span class="fu">ncol</span>(functional_groups)</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>Mmolx<span class="ot">=</span>(DS<span class="sc">$</span>MW_ACD<span class="dv">-300</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>nrfungroups<span class="ot">=</span>functional_groups</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>logkObs<span class="ot">=</span>DS<span class="sc">$</span>logk</span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>fi<span class="ot">=</span>DS<span class="sc">$</span>concentration</span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>run_estimation<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a><span class="fu">stan_rdump</span>(<span class="fu">c</span>(<span class="st">"nAnalytes"</span>, </span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>             <span class="st">"nObs"</span>,</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>             <span class="st">"start"</span>, </span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>             <span class="st">"analyte"</span>, </span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>             <span class="st">"logkObs"</span>, </span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>             <span class="st">"fi"</span>,</span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>             <span class="st">"K"</span>,</span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>             <span class="st">"nrfungroups"</span>,</span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Mmolx"</span>,</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>             <span class="st">"run_estimation"</span>),</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>           <span class="at">file=</span><span class="st">"2_model/model.data.R"</span>)</span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a>initial_param_A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">2</span>)</span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a>  initial_param_A[i,] <span class="ot">=</span> </span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">polyfit</span>(DS<span class="sc">$</span>concentration[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>DS<span class="sc">$</span>concentration[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)]),</span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>            DS<span class="sc">$</span>logk[<span class="fu">which</span>(DS<span class="sc">$</span>ID<span class="sc">==</span>i)],<span class="dv">1</span>)</span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>initial_param_A <span class="ot">=</span> <span class="fu">cbind</span>(initial_param_A,<span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes))</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>param <span class="ot">=</span> <span class="fu">cbind</span>(initial_param_A[,<span class="dv">2</span>], initial_param_A[,<span class="dv">2</span>] <span class="sc">+</span> initial_param_A[,<span class="dv">1</span>]<span class="sc">/</span><span class="dv">3</span>, <span class="fu">log10</span>(initial_param_A[,<span class="dv">3</span>]))</span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a>  logkwHat  <span class="ot">=</span>  <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">6.6</span>,<span class="dv">1</span>)</span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>  logkaHat  <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">1.3</span>,<span class="dv">1</span>)</span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>  logS2Hat <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="dv">2</span>),<span class="fl">0.1</span>)</span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="fl">0.2</span>,<span class="dv">0</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span><span class="fu">rlnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">0.05</span>),<span class="fl">0.2</span>)</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>  nuobs <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>  nupi <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>  pilogkw <span class="ot">=</span> <span class="fu">rlnorm</span>(K,<span class="fu">log</span>(<span class="fl">0.2</span>),<span class="fl">0.5</span>)</span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a>  pidlogk <span class="ot">=</span> <span class="fu">rnorm</span>(K,<span class="fl">0.2</span>, <span class="fl">0.5</span>)</span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>  pilogS2 <span class="ot">=</span> <span class="fu">rnorm</span>(K,<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>  omega<span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>  spilogkw<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>  spidlogk<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>  spilogS2<span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>  mpilogkw <span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>  mpidlogk <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>  param  <span class="ot">=</span> param</span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_rdump</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"logkaHat"</span>,<span class="st">"logS2Hat"</span>,<span class="st">"beta"</span>,<span class="st">"rho"</span>,<span class="st">"sigma"</span>,</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>               <span class="st">"nu"</span>,<span class="st">"nuobs"</span>,<span class="st">"nupi"</span>,<span class="st">"pilogkw"</span>,<span class="st">"pidlogk"</span>,<span class="st">"pilogS2"</span>,<span class="st">"omega"</span>,</span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>               <span class="st">"spilogkw"</span>,<span class="st">"spidlogk"</span>,<span class="st">"spilogS2"</span>,<span class="st">"mpilogkw"</span>,<span class="st">"mpidlogk"</span>,<span class="st">"param"</span>),</span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>             <span class="at">file=</span><span class="fu">paste</span>(<span class="st">"2_model/model_"</span>, i, <span class="st">".init.R"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of estimated model parameters</span></span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>Code for print summary of parameters from supercomputer:</span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="st">'2_model/output_1.csv'</span>,</span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_2.csv'</span>,</span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_3.csv'</span>,</span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_4.csv'</span>,</span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_5.csv'</span>,</span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_6.csv'</span>,</span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_7.csv'</span>,</span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_8.csv'</span>,</span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_9.csv'</span>,</span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2_model/output_10.csv'</span>))</span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"logkaHat"</span>,<span class="st">"logS2Hat"</span>,<span class="st">"beta"</span>,<span class="st">"rho"</span>,<span class="st">"sigma"</span>,<span class="st">"nu"</span>,<span class="st">"nuobs"</span>,<span class="st">"nupi"</span>,<span class="st">"omega"</span>,</span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>            <span class="st">"spilogkw"</span>,<span class="st">"spidlogk"</span>,<span class="st">"spilogS2"</span>,<span class="st">"mpilogkw"</span>,<span class="st">"mpidlogk"</span>), <span class="at">max_rows =</span> <span class="dv">30</span>)</span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>